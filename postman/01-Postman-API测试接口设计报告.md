# Docker Registry HTTP API V2 - Postmanæµ‹è¯•æ¥å£è®¾è®¡æŠ¥å‘Š

## ğŸ“„ æŠ¥å‘Šæ¦‚è¿°

**é¡¹ç›®åç§°**: Docker Registry HTTP API V2 ç®€åŒ–å®ç°  
**æµ‹è¯•å·¥å…·**: Postman Collection  
**è®¾è®¡æ—¥æœŸ**: 2025å¹´10æœˆ1æ—¥  
**è®¾è®¡ç›®æ ‡**: å®Œæ•´è¦†ç›–Docker Registry HTTP API V2è§„èŒƒçš„11ä¸ªæ ¸å¿ƒAPI

---

## ğŸ¯ è®¾è®¡ç›®æ ‡ä¸åŸåˆ™

### è®¾è®¡ç›®æ ‡
1. **å®Œæ•´æ€§**: è¦†ç›–Docker Registry HTTP API V2è§„èŒƒçš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
2. **è‡ªåŠ¨åŒ–**: æœ€å¤§ç¨‹åº¦å‡å°‘æ‰‹åŠ¨æ“ä½œï¼Œå®ç°å‚æ•°è‡ªåŠ¨ä¼ é€’
3. **æ˜“ç”¨æ€§**: æä¾›æ¸…æ™°çš„æ“ä½œæŒ‡å¯¼å’Œé”™è¯¯æç¤º
4. **æ ‡å‡†åŒ–**: ä¸¥æ ¼éµå¾ªDocker Registry APIè§„èŒƒ

### è®¾è®¡åŸåˆ™
1. **æ¨¡å—åŒ–ç»“æ„**: æŒ‰åŠŸèƒ½åˆ†ç»„ç»„ç»‡APIæµ‹è¯•
2. **å‚æ•°å¤ç”¨**: é€šè¿‡ç¯å¢ƒå˜é‡å®ç°å‚æ•°è‡ªåŠ¨ä¼ é€’
3. **é”™è¯¯å¤„ç†**: åŒ…å«å®Œæ•´çš„é”™è¯¯åœºæ™¯æµ‹è¯•
4. **æ–‡æ¡£åŒ–**: æ¯ä¸ªè¯·æ±‚éƒ½æœ‰è¯¦ç»†çš„è¯´æ˜å’Œä½¿ç”¨æŒ‡å¯¼

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### Collectionç»“æ„
```
Docker Registry HTTP API V2
â”œâ”€â”€ 01. Health Check (å¥åº·æ£€æŸ¥)
â”‚   â”œâ”€â”€ Check API Version
â”‚   â””â”€â”€ Health Ping
â”œâ”€â”€ 02. Blob Operations (Blobæ“ä½œ)
â”‚   â”œâ”€â”€ Start Upload Session
â”‚   â”œâ”€â”€ Upload Chunk
â”‚   â”œâ”€â”€ Complete Upload
â”‚   â”œâ”€â”€ Check Blob Exists (HEAD)
â”‚   â”œâ”€â”€ Download Blob
â”‚   â”œâ”€â”€ Get Upload Status
â”‚   â””â”€â”€ Cancel Upload
â”œâ”€â”€ 03. Manifest Operations (Manifestæ“ä½œ)
â”‚   â”œâ”€â”€ Upload Manifest
â”‚   â”œâ”€â”€ Check Manifest Exists (HEAD)
â”‚   â”œâ”€â”€ Get Manifest by Tag
â”‚   â”œâ”€â”€ Get Manifest by Digest
â”‚   â””â”€â”€ Delete Manifest
â””â”€â”€ 04. Error Handling Tests (é”™è¯¯å¤„ç†æµ‹è¯•)
    â”œâ”€â”€ 404 - Nonexistent Blob
    â”œâ”€â”€ 404 - Nonexistent Manifest
    â”œâ”€â”€ 400 - Invalid Manifest JSON
    â””â”€â”€ 415 - Unsupported Media Type
```

### ç¯å¢ƒå˜é‡è®¾è®¡
```javascript
// åŸºç¡€é…ç½®
baseUrl: "http://localhost:8080"
repository: "myapp"
tag: "latest"

// åŠ¨æ€å˜é‡
uploadUuid: ""          // ä¸Šä¼ ä¼šè¯ID
blobDigest: ""          // Blob SHA256æ‘˜è¦
manifestDigest: ""      // Manifest SHA256æ‘˜è¦
contentDigest: ""       // å†…å®¹æ‘˜è¦(ç”¨äºComplete Upload)
blobSize: ""           // Blobæ–‡ä»¶å¤§å°
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 1. å¥åº·æ£€æŸ¥æ¨¡å—
**ç›®æ ‡**: éªŒè¯RegistryæœåŠ¡åŸºç¡€åŠŸèƒ½
- **Check API Version**: éªŒè¯`/v2/`ç«¯ç‚¹å’ŒAPIç‰ˆæœ¬å¤´
- **Health Ping**: éªŒè¯`/v2/_ping`å¥åº·æ£€æŸ¥ç«¯ç‚¹

### 2. Blobæ“ä½œæ¨¡å—
**ç›®æ ‡**: å®Œæ•´æµ‹è¯•Dockeré•œåƒå±‚æ•°æ®çš„ä¸Šä¼ ä¸‹è½½æµç¨‹

#### åˆ†ç‰‡ä¸Šä¼ è®¾è®¡
```javascript
// Pre-request Scriptè‡ªåŠ¨å¤„ç†
1. æ£€æµ‹æ–‡ä»¶ä¸Šä¼ æ¨¡å¼ (X-File-SHA256å¤´)
2. è‡ªåŠ¨è®¡ç®—æˆ–ä½¿ç”¨é¢„è®¾SHA256
3. è®¾ç½®ç¯å¢ƒå˜é‡ä¾›åç»­è¯·æ±‚ä½¿ç”¨
4. æä¾›è¯¦ç»†çš„æ§åˆ¶å°è¾“å‡ºæŒ‡å¯¼
```

#### å…³é”®ç‰¹æ€§
- **æ™ºèƒ½æ¨¡å¼æ£€æµ‹**: æ”¯æŒé»˜è®¤æµ‹è¯•æ¨¡å¼å’ŒçœŸå®æ–‡ä»¶ä¸Šä¼ æ¨¡å¼
- **å‚æ•°è‡ªåŠ¨ä¼ é€’**: Upload UUIDã€Content Digestè‡ªåŠ¨ä¿å­˜å’Œä¼ é€’
- **Rangeæ”¯æŒ**: æ­£ç¡®å¤„ç†HTTP Rangeè¯·æ±‚
- **é”™è¯¯éªŒè¯**: å®Œæ•´çš„çŠ¶æ€ç å’Œå“åº”å¤´éªŒè¯

### 3. Manifestæ“ä½œæ¨¡å—
**ç›®æ ‡**: æµ‹è¯•Dockeré•œåƒå…ƒæ•°æ®çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

#### åŠ¨æ€Manifestç”Ÿæˆ
```json
{
  "schemaVersion": 2,
  "mediaType": "application/vnd.docker.distribution.manifest.v2+json",
  "config": {
    "mediaType": "application/vnd.docker.container.image.v1+json",
    "digest": "{{blobDigest}}",      // åŠ¨æ€å¼•ç”¨
    "size": {{blobSize}}             // åŠ¨æ€å¤§å°
  },
  "layers": [{
    "mediaType": "application/vnd.docker.image.rootfs.diff.tar.gzip",
    "digest": "{{blobDigest}}",      // åŠ¨æ€å¼•ç”¨
    "size": {{blobSize}}             // åŠ¨æ€å¤§å°
  }]
}
```

#### å‚æ•°éªŒè¯ç³»ç»Ÿ
```javascript
// Pre-requestéªŒè¯
const blobDigest = pm.environment.get('blobDigest');
const blobSize = pm.environment.get('blobSize');

if (!blobDigest || !blobSize) {
    console.log('âš ï¸ è­¦å‘Š: å¿…è¦å‚æ•°æœªè®¾ç½®');
    // æä¾›è¯¦ç»†æŒ‡å¯¼
}
```

### 4. é”™è¯¯å¤„ç†æµ‹è¯•æ¨¡å—
**ç›®æ ‡**: éªŒè¯APIçš„é”™è¯¯å“åº”ç¬¦åˆDocker Registryè§„èŒƒ

#### é”™è¯¯åœºæ™¯è¦†ç›–
- **404é”™è¯¯**: ä¸å­˜åœ¨çš„Blobå’ŒManifest
- **400é”™è¯¯**: æ— æ•ˆçš„JSONæ ¼å¼
- **415é”™è¯¯**: ä¸æ”¯æŒçš„åª’ä½“ç±»å‹

#### æ ‡å‡†é”™è¯¯æ ¼å¼éªŒè¯
```javascript
pm.test('Error response format is correct', function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('errors');
    pm.expect(jsonData.errors[0]).to.have.property('code');
    pm.expect(jsonData.errors[0]).to.have.property('message');
});
```

---

## ğŸš€ è‡ªåŠ¨åŒ–ç‰¹æ€§

### 1. æ™ºèƒ½å‚æ•°ç®¡ç†
- **è‡ªåŠ¨SHA256è®¡ç®—**: å¯¹é»˜è®¤æµ‹è¯•å†…å®¹è‡ªåŠ¨ç”ŸæˆSHA256
- **æ–‡ä»¶å¤§å°è§£æ**: ä»Content-Rangeå¤´è‡ªåŠ¨æå–æ–‡ä»¶å¤§å°
- **Digestä¼ é€’**: å„æ­¥éª¤é—´è‡ªåŠ¨ä¼ é€’æ‘˜è¦å€¼

### 2. ç”¨æˆ·å‹å¥½è®¾è®¡
- **æ§åˆ¶å°æŒ‡å¯¼**: è¯¦ç»†çš„æ“ä½œæç¤ºå’Œå‚æ•°è¯´æ˜
- **æ¨¡å¼æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«æµ‹è¯•æ¨¡å¼vsæ–‡ä»¶ä¸Šä¼ æ¨¡å¼
- **é”™è¯¯æç¤º**: æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®

### 3. æµ‹è¯•éªŒè¯
- **çŠ¶æ€ç éªŒè¯**: æ¯ä¸ªè¯·æ±‚éƒ½æœ‰å®Œæ•´çš„çŠ¶æ€ç æ£€æŸ¥
- **å“åº”å¤´éªŒè¯**: éªŒè¯å…³é”®çš„Docker Registryå“åº”å¤´
- **æ•°æ®å®Œæ•´æ€§**: éªŒè¯è¿”å›æ•°æ®çš„æ ¼å¼å’Œå†…å®¹

---

## ğŸ“Š è®¾è®¡ä¼˜åŠ¿

### 1. å®Œæ•´æ€§
- âœ… è¦†ç›–Docker Registry HTTP API V2çš„11ä¸ªæ ¸å¿ƒAPI
- âœ… åŒ…å«å®Œæ•´çš„é”™è¯¯åœºæ™¯æµ‹è¯•
- âœ… æ”¯æŒå®Œæ•´çš„Blobå’ŒManifestç”Ÿå‘½å‘¨æœŸ

### 2. æ˜“ç”¨æ€§
- âœ… ä¸€é”®å¯¼å…¥å³å¯ä½¿ç”¨
- âœ… è‡ªåŠ¨åŒ–å‚æ•°ç®¡ç†å‡å°‘æ‰‹åŠ¨æ“ä½œ
- âœ… è¯¦ç»†çš„æ“ä½œæŒ‡å¯¼å’Œé”™è¯¯æç¤º

### 3. æ ‡å‡†åŒ–
- âœ… ä¸¥æ ¼éµå¾ªDocker Registry APIè§„èŒƒ
- âœ… æ ‡å‡†çš„HTTPçŠ¶æ€ç å’Œå“åº”å¤´éªŒè¯
- âœ… ç¬¦åˆDockerç”Ÿæ€ç³»ç»Ÿçš„æµ‹è¯•æ ‡å‡†

### 4. å¯æ‰©å±•æ€§
- âœ… æ¨¡å—åŒ–è®¾è®¡ä¾¿äºæ·»åŠ æ–°æµ‹è¯•
- âœ… ç¯å¢ƒå˜é‡ç³»ç»Ÿæ”¯æŒå¤šç¯å¢ƒé…ç½®
- âœ… çµæ´»çš„è„šæœ¬ç³»ç»Ÿæ”¯æŒå®šåˆ¶åŒ–

---

## ğŸ” ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹
1. **å¯¼å…¥Collection**: å°†JSONæ–‡ä»¶å¯¼å…¥Postman
2. **é…ç½®ç¯å¢ƒ**: è®¾ç½®baseUrlç­‰åŸºç¡€å˜é‡
3. **é¡ºåºæ‰§è¡Œ**: æŒ‰æ¨¡å—é¡ºåºæ‰§è¡Œæµ‹è¯•
4. **æŸ¥çœ‹ç»“æœ**: é€šè¿‡Consoleå’ŒTestsæŸ¥çœ‹è¯¦ç»†ç»“æœ

### é«˜çº§ä½¿ç”¨
1. **æ–‡ä»¶ä¸Šä¼ æµ‹è¯•**: ä½¿ç”¨X-File-SHA256å¤´è¿›è¡ŒçœŸå®æ–‡ä»¶æµ‹è¯•
2. **è‡ªå®šä¹‰é…ç½®**: ä¿®æ”¹ç¯å¢ƒå˜é‡é€‚é…ä¸åŒç¯å¢ƒ
3. **æ‰¹é‡æµ‹è¯•**: ä½¿ç”¨Collection Runnerè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

---

## ğŸ“ˆ æŠ€æœ¯æŒ‡æ ‡

### APIè¦†ç›–ç‡
- **åŸºç¡€API**: 2/2 (100%)
- **Blob API**: 7/7 (100%)
- **Manifest API**: 4/4 (100%)
- **é”™è¯¯å¤„ç†**: 4ç§ä¸»è¦é”™è¯¯ç±»å‹
- **æ€»è¦†ç›–ç‡**: 13/13 (100%)

### è‡ªåŠ¨åŒ–ç¨‹åº¦
- **å‚æ•°ä¼ é€’**: 90%è‡ªåŠ¨åŒ–
- **éªŒè¯æµ‹è¯•**: 100%è‡ªåŠ¨åŒ–
- **é”™è¯¯å¤„ç†**: 100%è¦†ç›–

---

## ğŸ¯ è®¾è®¡æ€»ç»“

æœ¬Postmanæµ‹è¯•é›†åˆæˆåŠŸå®ç°äº†Docker Registry HTTP API V2çš„å®Œæ•´æµ‹è¯•è¦†ç›–ï¼Œé€šè¿‡æ™ºèƒ½çš„å‚æ•°ç®¡ç†å’Œè‡ªåŠ¨åŒ–éªŒè¯ï¼Œä¸ºDocker Registryå®ç°æä¾›äº†å¯é çš„æµ‹è¯•å·¥å…·ã€‚è®¾è®¡å……åˆ†è€ƒè™‘äº†æ˜“ç”¨æ€§å’Œæ ‡å‡†åŒ–ï¼Œæ—¢é€‚åˆå¼€å‘è°ƒè¯•ï¼Œä¹Ÿé€‚åˆé›†æˆæµ‹è¯•ä½¿ç”¨ã€‚

**è®¾è®¡æˆåŠŸè¦ç´ **:
1. **å®Œæ•´çš„APIè¦†ç›–**: 13ä¸ªæ ¸å¿ƒAPIå…¨éƒ¨è¦†ç›–
2. **æ™ºèƒ½çš„è‡ªåŠ¨åŒ–**: æœ€å¤§ç¨‹åº¦å‡å°‘æ‰‹åŠ¨æ“ä½œ
3. **æ ‡å‡†åŒ–çš„éªŒè¯**: ä¸¥æ ¼éµå¾ªDocker Registryè§„èŒƒ
4. **ç”¨æˆ·å‹å¥½çš„è®¾è®¡**: è¯¦ç»†æŒ‡å¯¼å’Œé”™è¯¯æç¤º

è¿™ä¸ªæµ‹è¯•é›†åˆä¸ºDocker Registryçš„è´¨é‡ä¿è¯æä¾›äº†åšå®çš„åŸºç¡€ã€‚
