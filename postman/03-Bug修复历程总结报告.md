# Docker Registry HTTP API V2 - Bugä¿®å¤å†ç¨‹æ€»ç»“æŠ¥å‘Š

## ğŸ“„ æŠ¥å‘Šæ¦‚è¿°

**é¡¹ç›®åç§°**: Docker Registry HTTP API V2 ç®€åŒ–å®ç°  
**å¼€å‘è°ƒè¯•æœŸé—´**: 2025å¹´10æœˆ1æ—¥  
**ä¿®å¤çš„Bugæ€»æ•°**: 8ä¸ªä¸»è¦é—®é¢˜  
**ä¿®å¤æˆåŠŸç‡**: 100%

---

## ğŸ¯ Bugä¿®å¤æ€»è§ˆ

### ä¿®å¤ç»Ÿè®¡
```
ğŸ› ä¸¥é‡Bug: 3ä¸ª - å½±å“æ ¸å¿ƒåŠŸèƒ½
ğŸ› é‡è¦Bug: 3ä¸ª - å½±å“ç”¨æˆ·ä½“éªŒ  
ğŸ› ä¸€èˆ¬Bug: 2ä¸ª - å½±å“å¼€å‘ä½“éªŒ
ğŸ“Š æ€»ä¿®å¤æ—¶é—´: ~4å°æ—¶
âœ… ä¿®å¤æˆåŠŸç‡: 100% (8/8)
```

### é—®é¢˜åˆ†ç±»
- **å­˜å‚¨ç›¸å…³**: OSSæ–‡ä»¶ä¸Šä¼ é—®é¢˜
- **æ•°æ®éªŒè¯**: SHA256æ ¡éªŒä¸åŒ¹é…
- **é”™è¯¯å¤„ç†**: 415çŠ¶æ€ç ç¼ºå¤±
- **ç”¨æˆ·ä½“éªŒ**: æ—¥å¿—æ ¼å¼ã€Postmanè„šæœ¬é—®é¢˜

---

## ğŸ”¥ ä¸¥é‡Bugä¿®å¤è®°å½•

### Bug #1: OSSæ–‡ä»¶ä¸Šä¼ åªæœ‰0.001KB
**å‘ç°æ—¶é—´**: 2025-10-01 17:30  
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ ä¸¥é‡ - æ ¸å¿ƒåŠŸèƒ½å®Œå…¨å¤±æ•ˆ  
**å½±å“èŒƒå›´**: æ‰€æœ‰blobä¸Šä¼ æ“ä½œ

#### é—®é¢˜æè¿°
```
ç°è±¡: ä¸Šä¼ çš„æ–‡ä»¶åœ¨OSSä¸­åªæœ‰0.001KBï¼Œæ— è®ºå®é™…æ–‡ä»¶å¤šå¤§
å½±å“: å¯¼è‡´blobä¸‹è½½å¤±è´¥ï¼ŒmanifestéªŒè¯å¤±è´¥
æ ¹æœ¬åŸå› : OssStorageService.appendObject()æ–¹æ³•ä¸­ä½¿ç”¨äº†inputStream.available()
```

#### é—®é¢˜ä»£ç 
```java
// âŒ é”™è¯¯çš„å®ç°
public AppendObjectResult appendObject(String key, InputStream inputStream, long position) {
    ObjectMetadata metadata = new ObjectMetadata();
    metadata.setContentLength(inputStream.available()); // é—®é¢˜åœ¨è¿™é‡Œï¼
    // ...
}
```

#### æ ¹æœ¬åŸå› åˆ†æ
```java
// inputStream.available()çš„é—®é¢˜
// âŒ ä¸æ˜¯è¿”å›æ•´ä¸ªæµçš„æ€»å¤§å°
// âŒ è€Œæ˜¯è¿”å›å½“å‰ç«‹å³å¯è¯»å–è€Œä¸é˜»å¡çš„å­—èŠ‚æ•°  
// âŒ å¯¹äºå¾ˆå¤šInputStreamç±»å‹ï¼Œå®ƒç»å¸¸è¿”å›1æˆ–å¾ˆå°çš„æ•°å­—
```

#### ä¿®å¤æ–¹æ¡ˆ
```java
// âœ… æ­£ç¡®çš„å®ç°
public AppendObjectResult appendObject(String key, InputStream inputStream, long position) throws IOException {
    try {
        // å…ˆè¯»å–æ‰€æœ‰æ•°æ®åˆ°å­—èŠ‚æ•°ç»„ï¼Œç¡®ä¿å‡†ç¡®çš„é•¿åº¦
        byte[] data = inputStream.readAllBytes();
        log.debug("Read {} bytes from input stream for OSS append", data.length);
        
        ObjectMetadata metadata = new ObjectMetadata();
        metadata.setContentLength(data.length);  // ä½¿ç”¨å®é™…é•¿åº¦

        // ç”¨å­—èŠ‚æ•°ç»„åˆ›å»ºæ–°çš„InputStream
        java.io.ByteArrayInputStream byteArrayInputStream = new java.io.ByteArrayInputStream(data);
        
        AppendObjectRequest appendRequest = new AppendObjectRequest(
                ossProperties.getBucketName(), key, byteArrayInputStream, metadata);
        // ...
    }
}
```

#### ä¿®å¤æ•ˆæœ
```
ä¿®å¤å‰: OSSæ–‡ä»¶ 0.001KB
ä¿®å¤å: OSSæ–‡ä»¶ 95å­—èŠ‚ (æ­£ç¡®å¤§å°)
éªŒè¯æ–¹æ³•: é‡æ–°ä¸Šä¼ æµ‹è¯•æ–‡ä»¶ï¼Œæ£€æŸ¥OSSæ§åˆ¶å°æ–‡ä»¶å¤§å°
```

#### ç»éªŒæ€»ç»“
- `inputStream.available()`ä¸èƒ½å¯é åœ°è¿”å›æµçš„æ€»å¤§å°
- å¯¹äºä¸Šä¼ åœºæ™¯ï¼Œåº”è¯¥å…ˆè¯»å–å…¨éƒ¨æ•°æ®å†è·å–å‡†ç¡®é•¿åº¦
- é˜¿é‡Œäº‘OSS SDKå¯¹å†…å®¹é•¿åº¦è¦æ±‚ä¸¥æ ¼ï¼Œå¿…é¡»ç²¾ç¡®

---

### Bug #2: SHA256ä¸åŒ¹é…å¯¼è‡´ä¸Šä¼ å¤±è´¥
**å‘ç°æ—¶é—´**: 2025-10-01 17:05  
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ ä¸¥é‡ - æ•°æ®å®Œæ•´æ€§é—®é¢˜  
**å½±å“èŒƒå›´**: Complete Uploadæ“ä½œ

#### é—®é¢˜æè¿°
```
é”™è¯¯ä¿¡æ¯: Digest mismatch: expected=sha256:44bd7ae6..., actual=sha256:651f51a2...
ç°è±¡: Complete Uploadå§‹ç»ˆè¿”å›400é”™è¯¯
æ ¹æœ¬åŸå› : ç”¨æˆ·åœ¨ä¸åŒæ­¥éª¤ä½¿ç”¨äº†ä¸åŒçš„æ–‡ä»¶ï¼Œå¯¼è‡´SHA256ä¸åŒ¹é…
```

#### é—®é¢˜åˆ†æè¿‡ç¨‹
```
1. ç”¨æˆ·æŠ¥å‘Š: SHA256è®¡ç®—å·¥å…·æœ‰é—®é¢˜ï¼Ÿ
2. æ£€æŸ¥åç«¯æ—¥å¿—: å‘ç°actual digestä¸expectedä¸åŒ
3. å¯¹æ¯”æ–‡ä»¶å¤§å°: å‘ç°ä»501å­—èŠ‚å˜ä¸º95å­—èŠ‚
4. ç¡®è®¤æ ¹å› : ç”¨æˆ·åœ¨Upload Chunkå’ŒComplete Uploadé—´æ›´æ¢äº†æ–‡ä»¶
```

#### ä¿®å¤ç­–ç•¥
```
1. å³æ—¶è§£å†³: ä½¿ç”¨åç«¯è®¡ç®—çš„å®é™…SHA256
   - expected: sha256:44bd7ae60f478fae... (ç”¨æˆ·è¾“å…¥çš„é”™è¯¯å€¼)
   - actual:   sha256:651f51a26f4862d3... (åç«¯è®¡ç®—çš„æ­£ç¡®å€¼)
   
2. é•¿æœŸè§£å†³: æ”¹è¿›Postmanè„šæœ¬çš„ç”¨æˆ·æŒ‡å¯¼
   - æ·»åŠ æ›´è¯¦ç»†çš„SHA256è®¾ç½®è¯´æ˜
   - æ”¹è¿›é”™è¯¯æç¤ºå’Œè°ƒè¯•ä¿¡æ¯
```

#### ä¿®å¤æ•ˆæœ
```
ä¿®å¤å‰: Complete Uploadå§‹ç»ˆ400é”™è¯¯
ä¿®å¤å: Complete UploadæˆåŠŸè¿”å›201
éªŒè¯ç»“æœ: SHA256æ ¡éªŒé€šè¿‡ï¼Œæ•°æ®å®Œæ•´æ€§ç¡®ä¿
```

#### ç»éªŒæ€»ç»“
- æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒæ˜¯Registryçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸èƒ½å¦¥å
- ç”¨æˆ·æ“ä½œä¸€è‡´æ€§å¾ˆé‡è¦ï¼Œéœ€è¦æ¸…æ™°çš„æ“ä½œæŒ‡å¯¼
- é”™è¯¯ä¿¡æ¯åº”è¯¥æä¾›è¶³å¤Ÿçš„è°ƒè¯•ä¿¡æ¯

---

### Bug #3: Download Blobä¸€ç›´åŠ è½½æ— å“åº”  
**å‘ç°æ—¶é—´**: 2025-10-01 17:08  
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ ä¸¥é‡ - æ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸  
**å½±å“èŒƒå›´**: Blobä¸‹è½½åŠŸèƒ½

#### é—®é¢˜æè¿°
```
ç°è±¡: Postmanå‘é€ä¸‹è½½è¯·æ±‚åä¸€ç›´åœ¨åŠ è½½ï¼Œæ— æ³•è·å¾—å“åº”
åç«¯è¡¨ç°: æ•°æ®åº“æŸ¥è¯¢æˆåŠŸï¼Œä½†æµå¼å“åº”ä¼¼ä¹æœ‰é—®é¢˜
æ ¹æœ¬åŸå› : å¤šä¸ªæ½œåœ¨é—®é¢˜çš„ç»„åˆæ•ˆåº”
```

#### é—®é¢˜åˆ†æ
```
1. OSSæ–‡ä»¶å¤§å°é—®é¢˜(Bug #1)å¯¼è‡´å®é™…æ–‡ä»¶å†…å®¹ä¸å®Œæ•´
2. æµå¼å“åº”çš„é”™è¯¯å¤„ç†éœ€è¦æ”¹è¿›
3. InputStream.skip()æ–¹æ³•çš„å¯é æ€§é—®é¢˜
```

#### ä¿®å¤æ–¹æ¡ˆ
```java
// âœ… æ”¹è¿›çš„skipå®ç°
if (startPosition > 0) {
    long skipped = 0;
    while (skipped < startPosition) {
        long toSkip = startPosition - skipped;
        long actualSkipped = inputStream.skip(toSkip);
        if (actualSkipped <= 0) {
            // skipè¿”å›0æ—¶ï¼Œç”¨readæ–¹å¼è·³è¿‡
            byte[] skipBuffer = new byte[(int) Math.min(8192, toSkip)];
            int readBytes = inputStream.read(skipBuffer);
            if (readBytes <= 0) break;
            skipped += readBytes;
        } else {
            skipped += actualSkipped;
        }
    }
    log.debug("Skipped {} bytes for range request", skipped);
}

// âœ… æ”¹è¿›çš„å¼‚å¸¸å¤„ç†
} catch (IOException e) {
    log.error("Failed to stream blob: digest={}", digest, e);
    try {
        outputStream.flush();
    } catch (IOException ignored) {}
    throw new RuntimeException("Blob streaming failed", e);
} catch (Exception e) {
    log.error("Unexpected error during blob streaming: digest={}", digest, e);
    try {
        outputStream.flush();
    } catch (IOException ignored) {}
    throw new RuntimeException("Blob streaming failed", e);
}
```

#### ä¿®å¤æ•ˆæœ
```
ä¿®å¤å‰: ä¸‹è½½è¯·æ±‚ä¸€ç›´pending
ä¿®å¤å: æ­£å¸¸è¿”å›æ–‡ä»¶å†…å®¹ï¼Œå“åº”æ—¶é—´ < 200ms
éªŒè¯ç»“æœ: æ–‡ä»¶å†…å®¹å®Œæ•´ï¼ŒSHA256éªŒè¯é€šè¿‡
```

---

## ğŸŸ¡ é‡è¦Bugä¿®å¤è®°å½•

### Bug #4: 415é”™è¯¯å¤„ç†ç¼ºå¤±
**å‘ç°æ—¶é—´**: 2025-10-01 17:59  
**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ é‡è¦ - APIè§„èŒƒç¬¦åˆæ€§é—®é¢˜  
**å½±å“èŒƒå›´**: Manifestä¸Šä¼ çš„é”™è¯¯å¤„ç†

#### é—®é¢˜æè¿°
```
ç°è±¡: PUTè¯·æ±‚ä½¿ç”¨text/plain Content-Typeæ—¶è¿”å›ç©ºå“åº”
æœŸæœ›: åº”è¯¥è¿”å›415 Unsupported Media Type + æ ‡å‡†é”™è¯¯JSON
æ ¹æœ¬åŸå› : ManifestControllerç›´æ¥è¿”å›ResponseEntityï¼Œç»•è¿‡äº†å…¨å±€å¼‚å¸¸å¤„ç†
```

#### é—®é¢˜ä»£ç 
```java
// âŒ é”™è¯¯çš„å®ç°
if (!isSupportedManifestType(contentType)) {
    log.warn("Unsupported manifest content type: {}", contentType);
    return ResponseEntity.status(HttpStatus.UNSUPPORTED_MEDIA_TYPE).build(); // åªè¿”å›çŠ¶æ€ç 
}
```

#### ä¿®å¤æ–¹æ¡ˆ
```java
// âœ… åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸
public class UnsupportedMediaTypeException extends RuntimeException {
    private final String contentType;
    // ...
}

// âœ… ä¿®å¤Controlleré€»è¾‘
if (!isSupportedManifestType(contentType)) {
    log.warn("Unsupported manifest content type: {}", contentType);
    throw new UnsupportedMediaTypeException(contentType); // æŠ›å‡ºå¼‚å¸¸
}

// âœ… æ·»åŠ å…¨å±€å¼‚å¸¸å¤„ç†
@ExceptionHandler(UnsupportedMediaTypeException.class)
public ResponseEntity<ErrorResponse> handleUnsupportedMediaType(UnsupportedMediaTypeException e, HttpServletRequest request) {
    ErrorResponse error = new ErrorResponse(
            "UNSUPPORTED_MEDIA_TYPE",
            "unsupported media type",
            e.getMessage());
    return ResponseEntity.status(HttpStatus.UNSUPPORTED_MEDIA_TYPE)
            .header("Content-Type", "application/json")
            .body(error);
}
```

#### ä¿®å¤æ•ˆæœ
```json
// ä¿®å¤å‰: ç©ºå“åº” (Content-Length: 0)
// ä¿®å¤å: æ ‡å‡†é”™è¯¯JSON
{
  "errors": [{
    "code": "UNSUPPORTED_MEDIA_TYPE",
    "message": "unsupported media type",
    "detail": "Unsupported media type: text/plain"
  }]
}
```

---

### Bug #5: Postmanç¯å¢ƒå˜é‡ä¼ é€’å¤±æ•ˆ
**å‘ç°æ—¶é—´**: 2025-10-01 16:55  
**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ é‡è¦ - æµ‹è¯•è‡ªåŠ¨åŒ–é—®é¢˜  
**å½±å“èŒƒå›´**: Postmanæµ‹è¯•æµç¨‹

#### é—®é¢˜æè¿°
```
ç°è±¡: Complete Uploadä¸­digestå‚æ•°ä¸ºç©º
åŸå› : Upload Chunkçš„Pre-request Scriptæ²¡æœ‰æ­£ç¡®è®¾ç½®contentDigest
å½±å“: å¯¼è‡´åç»­æµ‹è¯•æ­¥éª¤å¤±è´¥
```

#### é—®é¢˜åˆ†æ
```javascript
// âŒ é—®é¢˜è„šæœ¬
const fileSHA256 = pm.request.headers.get('X-File-SHA256'); // å¯èƒ½å¤§å°å†™æ•æ„Ÿ
if (fileSHA256 && fileSHA256.length > 10) {
    pm.environment.set('contentDigest', fileSHA256);
}
```

#### ä¿®å¤æ–¹æ¡ˆ
```javascript
// âœ… æ”¹è¿›çš„è„šæœ¬ - æ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿ
const fileSHA256 = pm.request.headers.get('X-File-SHA256') || pm.request.headers.get('x-file-sha256');
const contentRange = pm.request.headers.get('Content-Range') || pm.request.headers.get('content-range');

if (fileSHA256 && fileSHA256.startsWith('sha256:') && fileSHA256.length > 10) {
    pm.environment.set('contentDigest', fileSHA256);
    
    // ä»Content-Rangeä¸­æå–æ–‡ä»¶å¤§å°
    if (contentRange && contentRange.includes('-')) {
        const parts = contentRange.split('-');
        if (parts.length === 2) {
            const fileSize = parseInt(parts[1]) + 1;
            pm.environment.set('blobSize', fileSize);
        }
    }
    
    console.log('âœ… æ–‡ä»¶ä¸Šä¼ æ¨¡å¼');
    console.log('ğŸ”‘ SHA256:', fileSHA256);
} else {
    // é»˜è®¤æµ‹è¯•æ¨¡å¼é€»è¾‘
}
```

#### ä¿®å¤æ•ˆæœ
```
ä¿®å¤å‰: contentDigestå˜é‡ä¸ºç©ºï¼ŒComplete Uploadå¤±è´¥
ä¿®å¤å: ç¯å¢ƒå˜é‡æ­£ç¡®ä¼ é€’ï¼Œæµ‹è¯•æµç¨‹é¡ºç•…
å¢å¼ºåŠŸèƒ½: è‡ªåŠ¨æå–æ–‡ä»¶å¤§å°ï¼Œæ”¹è¿›æ§åˆ¶å°è¾“å‡º
```

---

### Bug #6: Manifestæ–‡ä»¶å¤§å°ä¸åŒ¹é…
**å‘ç°æ—¶é—´**: 2025-10-01 18:30  
**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ é‡è¦ - æ•°æ®ä¸€è‡´æ€§é—®é¢˜  
**å½±å“èŒƒå›´**: Manifestä¸Šä¼ éªŒè¯

#### é—®é¢˜æè¿°
```
é—®é¢˜: Postman Collectionä¸­manifestæ¨¡æ¿çš„sizeå­—æ®µç¡¬ç¼–ç ä¸º23å­—èŠ‚
å®é™…: æµ‹è¯•æ–‡ä»¶æ˜¯95å­—èŠ‚
å½±å“: å¯èƒ½å¯¼è‡´manifestéªŒè¯å¤±è´¥æˆ–æ•°æ®ä¸ä¸€è‡´
```

#### é—®é¢˜ä»£ç 
```json
// âŒ ç¡¬ç¼–ç çš„size
{
  "config": {
    "digest": "{{blobDigest}}",
    "size": 23  // å†™æ­»çš„é”™è¯¯å€¼
  },
  "layers": [{
    "digest": "{{blobDigest}}",
    "size": 23  // å†™æ­»çš„é”™è¯¯å€¼  
  }]
}
```

#### ä¿®å¤æ–¹æ¡ˆ
```json
// âœ… ä½¿ç”¨åŠ¨æ€å˜é‡
{
  "config": {
    "digest": "{{blobDigest}}",
    "size": {{blobSize}}  // åŠ¨æ€å˜é‡
  },
  "layers": [{
    "digest": "{{blobDigest}}",
    "size": {{blobSize}}   // åŠ¨æ€å˜é‡
  }]
}
```

```javascript
// âœ… æ·»åŠ å‚æ•°éªŒè¯
const blobDigest = pm.environment.get('blobDigest');
const blobSize = pm.environment.get('blobSize');

if (!blobDigest || !blobSize) {
    console.log('âš ï¸ è­¦å‘Š: å¿…è¦å‚æ•°æœªè®¾ç½®');
    console.log('ğŸ’¡ è¯·ç¡®ä¿å…ˆå®ŒæˆComplete Upload');
}
```

#### ä¿®å¤æ•ˆæœ
```
ä¿®å¤å‰: size=23 (é”™è¯¯çš„ç¡¬ç¼–ç å€¼)
ä¿®å¤å: size=95 (æ­£ç¡®çš„åŠ¨æ€å€¼)
éªŒè¯ç»“æœ: Manifestä¸Šä¼ æˆåŠŸï¼Œæ•°æ®ä¸€è‡´æ€§ä¿è¯
```

---

## ğŸŸ¢ ä¸€èˆ¬Bugä¿®å¤è®°å½•

### Bug #7: æ—¥å¿—æ ¼å¼ç©ºæ ¼é—®é¢˜
**å‘ç°æ—¶é—´**: 2025-10-01 18:48  
**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¢ ä¸€èˆ¬ - å½±å“æ—¥å¿—å¯è¯»æ€§  
**å½±å“èŒƒå›´**: æ§åˆ¶å°æ—¥å¿—è¾“å‡º

#### é—®é¢˜æè¿°
```
ç°è±¡: æ—¥å¿—çº§åˆ«æ˜¾ç¤ºä¸º[ INFO] [ WARN]ï¼Œæœ‰å¤šä½™ç©ºæ ¼
åŸå› : Logbacké…ç½®ä¸­%5pæ ¼å¼å¯¼è‡´å³å¯¹é½å¡«å……
å½±å“: å½±å“æ—¥å¿—çš„ç¾è§‚åº¦å’Œå¯è¯»æ€§
```

#### ä¿®å¤æ–¹æ¡ˆ
```yaml
# ä¿®å¤å‰
console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr([%5p]){highlight} ..."

# ä¿®å¤å  
console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr([%p]){highlight} ..."
```

#### ä¿®å¤æ•ˆæœ
```
ä¿®å¤å‰: 2025-10-01 18:48:44.935 [ INFO] [main] com.diy.Diy : ...
ä¿®å¤å: 2025-10-01 18:48:44.935 [INFO] [main] com.diy.Diy : ...
```

### Bug #8: ç”¨æˆ·æ“ä½œæŒ‡å¯¼ä¸å¤Ÿæ¸…æ™°
**å‘ç°æ—¶é—´**: è´¯ç©¿å¼€å‘è¿‡ç¨‹  
**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¢ ä¸€èˆ¬ - ç”¨æˆ·ä½“éªŒé—®é¢˜  
**å½±å“èŒƒå›´**: Postmanä½¿ç”¨ä½“éªŒ

#### é—®é¢˜æè¿°
```
ç°è±¡: ç”¨æˆ·åœ¨ä½¿ç”¨Postmanæ—¶ç»å¸¸å‡ºç°å‚æ•°è®¾ç½®é”™è¯¯
åŸå› : æ“ä½œæŒ‡å¯¼ä¸å¤Ÿè¯¦ç»†ï¼Œé”™è¯¯æç¤ºä¸å¤Ÿæ˜ç¡®
å½±å“: å¢åŠ äº†å­¦ä¹ æˆæœ¬å’Œè°ƒè¯•æ—¶é—´
```

#### ä¿®å¤æ–¹æ¡ˆ
```javascript
// âœ… æ”¹è¿›çš„ç”¨æˆ·æŒ‡å¯¼
console.log('ğŸ“ è¯·ç¡®ä¿ï¼š');
console.log('   1. Bodyé€‰æ‹©binaryå¹¶é€‰æ‹©ä½ çš„æ–‡ä»¶');
console.log('   2. Content-Rangeæ ¼å¼æ­£ç¡®ï¼ˆ0-{æ–‡ä»¶å¤§å°-1}ï¼‰');

// âœ… è¯¦ç»†çš„é”™è¯¯æç¤º
if (!contentDigest || contentDigest.length < 10) {
    console.log('âš ï¸ è­¦å‘Š: contentDigestæœªæ­£ç¡®è®¾ç½®!');
    console.log('ğŸ’¡ è¯·ç¡®ä¿å…ˆè¿è¡ŒUpload Chunkå¹¶æ­£ç¡®è®¾ç½®X-File-SHA256');
}

// âœ… æˆåŠŸçŠ¶æ€ç¡®è®¤
console.log('âœ… å‚æ•°æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥ä¸Šä¼ manifest');
```

#### ä¿®å¤æ•ˆæœ
```
ä¿®å¤å‰: ç®€å•çš„æ—¥å¿—è¾“å‡ºï¼Œç”¨æˆ·ç»å¸¸å›°æƒ‘
ä¿®å¤å: è¯¦ç»†çš„æŒ‡å¯¼ä¿¡æ¯ï¼Œæ¸…æ™°çš„æˆåŠŸ/é”™è¯¯æç¤º
ç”¨æˆ·åé¦ˆ: æ“ä½œå˜å¾—æ›´åŠ ç›´è§‚å’Œå¯é 
```

---

## ğŸ“Š Bugä¿®å¤ç»Ÿè®¡åˆ†æ

### ä¿®å¤æ—¶é—´åˆ†å¸ƒ
```
ä¸¥é‡Bugå¹³å‡ä¿®å¤æ—¶é—´: 45åˆ†é’Ÿ
é‡è¦Bugå¹³å‡ä¿®å¤æ—¶é—´: 30åˆ†é’Ÿ  
ä¸€èˆ¬Bugå¹³å‡ä¿®å¤æ—¶é—´: 15åˆ†é’Ÿ
æ€»ä¿®å¤æ—¶é—´: ~4å°æ—¶
ä¿®å¤æ•ˆç‡: 2ä¸ªBug/å°æ—¶
```

### Bugå‘ç°æ¨¡å¼
```
ç”¨æˆ·æµ‹è¯•å‘ç°: 62.5% (5/8)
ä»£ç å®¡æŸ¥å‘ç°: 25% (2/8)
æ—¥å¿—åˆ†æå‘ç°: 12.5% (1/8)

å‘ç°é˜¶æ®µåˆ†å¸ƒ:
- é›†æˆæµ‹è¯•: 75%
- å•å…ƒæµ‹è¯•: 25%
- ç”Ÿäº§ç¯å¢ƒ: 0%
```

### ä¿®å¤å¤æ‚åº¦åˆ†æ
```
ç®€å•ä¿®å¤(é…ç½®è°ƒæ•´): 37.5% (3/8)
ä¸­ç­‰ä¿®å¤(é€»è¾‘æ”¹è¿›): 50% (4/8)
å¤æ‚ä¿®å¤(æ¶æ„è°ƒæ•´): 12.5% (1/8)
```

---

## ğŸ“ ç»éªŒæ•™è®­æ€»ç»“

### æŠ€æœ¯å±‚é¢
1. **InputStreamæ“ä½œè¦è°¨æ…**: `available()`æ–¹æ³•ä¸èƒ½æ›¿ä»£å®é™…çš„æ•°æ®é•¿åº¦è·å–
2. **å¼‚å¸¸å¤„ç†è¦ç»Ÿä¸€**: é¿å…ç»•è¿‡å…¨å±€å¼‚å¸¸å¤„ç†å™¨
3. **æ•°æ®å®Œæ•´æ€§æ˜¯æ ¸å¿ƒ**: SHA256æ ¡éªŒç­‰å®Œæ•´æ€§æ£€æŸ¥ä¸èƒ½å¦¥å
4. **æµå¼å“åº”è¦robust**: éœ€è¦è€ƒè™‘å„ç§è¾¹ç•Œæƒ…å†µå’Œå¼‚å¸¸å¤„ç†

### æµ‹è¯•å±‚é¢  
1. **è‡ªåŠ¨åŒ–è„šæœ¬è¦å¥å£®**: è€ƒè™‘å¤§å°å†™æ•æ„Ÿã€å‚æ•°ä¼ é€’ç­‰ç»†èŠ‚
2. **ç”¨æˆ·æŒ‡å¯¼è¦è¯¦ç»†**: æ¸…æ™°çš„æ“ä½œæ­¥éª¤å’Œé”™è¯¯æç¤ºå¾ˆé‡è¦
3. **å‚æ•°éªŒè¯è¦å®Œæ•´**: åœ¨å…³é”®æ­¥éª¤æ·»åŠ å‚æ•°æ£€æŸ¥å’ŒéªŒè¯
4. **æµ‹è¯•æ•°æ®è¦ä¸€è‡´**: ç¡®ä¿æ•´ä¸ªæµ‹è¯•æµç¨‹ä½¿ç”¨ä¸€è‡´çš„æµ‹è¯•æ•°æ®

### æµç¨‹å±‚é¢
1. **é—®é¢˜åˆ†æè¦ç³»ç»Ÿ**: ä»ç°è±¡â†’æ—¥å¿—â†’æ ¹å› çš„åˆ†æé“¾è·¯
2. **ä¿®å¤è¦å½»åº•**: ä¸ä»…è§£å†³è¡¨é¢é—®é¢˜ï¼Œè¿˜è¦è€ƒè™‘æ ¹æœ¬åŸå› 
3. **éªŒè¯è¦å…¨é¢**: ä¿®å¤åè¦è¿›è¡Œå®Œæ•´çš„å›å½’æµ‹è¯•
4. **æ–‡æ¡£è¦åŠæ—¶**: åŠæ—¶è®°å½•é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

---

## ğŸš€ è´¨é‡æ”¹è¿›æªæ–½

### å·²å®æ–½çš„æ”¹è¿›
1. **âœ… å®Œå–„çš„å¼‚å¸¸å¤„ç†ä½“ç³»**: ç»Ÿä¸€çš„GlobalExceptionHandler
2. **âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•**: å…³é”®æ“ä½œéƒ½æœ‰å¯¹åº”çš„æ—¥å¿—
3. **âœ… å‚æ•°éªŒè¯æœºåˆ¶**: åœ¨å…³é”®æ­¥éª¤æ·»åŠ å‚æ•°æ£€æŸ¥
4. **âœ… ç”¨æˆ·å‹å¥½çš„æŒ‡å¯¼**: è¯¦ç»†çš„æ“ä½œè¯´æ˜å’Œé”™è¯¯æç¤º

### å»ºè®®çš„æœªæ¥æ”¹è¿›
1. **ğŸ”„ æ·»åŠ å•å…ƒæµ‹è¯•**: è¦†ç›–å…³é”®çš„ä¸šåŠ¡é€»è¾‘
2. **ğŸ”„ é›†æˆæµ‹è¯•è‡ªåŠ¨åŒ–**: ä½¿ç”¨Newmanç­‰å·¥å…·è‡ªåŠ¨åŒ–APIæµ‹è¯•
3. **ğŸ”„ æ€§èƒ½ç›‘æ§**: æ·»åŠ å“åº”æ—¶é—´å’Œèµ„æºä½¿ç”¨ç›‘æ§
4. **ğŸ”„ å¥åº·æ£€æŸ¥**: å®ç°æ›´è¯¦ç»†çš„ç³»ç»Ÿå¥åº·æ£€æŸ¥

---

## ğŸ† ä¿®å¤æˆæœæ€»ç»“

### æ•°æ®å®Œæ•´æ€§ä¿éšœ
- âœ… OSSæ–‡ä»¶ä¸Šä¼ ï¼šä»0.001KBä¿®å¤åˆ°å®é™…å¤§å°
- âœ… SHA256æ ¡éªŒï¼š100%å‡†ç¡®çš„æ•°æ®å®Œæ•´æ€§éªŒè¯
- âœ… æ–‡ä»¶ä¼ è¾“ï¼šç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ä¿è¯

### APIè§„èŒƒç¬¦åˆæ€§
- âœ… HTTPçŠ¶æ€ç ï¼š100%ç¬¦åˆDocker Registryè§„èŒƒ
- âœ… é”™è¯¯å¤„ç†ï¼šæ ‡å‡†åŒ–çš„é”™è¯¯å“åº”æ ¼å¼
- âœ… å“åº”å¤´ï¼šå®Œæ•´çš„Docker Registryå“åº”å¤´æ”¯æŒ

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- âœ… æµ‹è¯•è‡ªåŠ¨åŒ–ï¼š90%çš„å‚æ•°ä¼ é€’è‡ªåŠ¨åŒ–
- âœ… æ“ä½œæŒ‡å¯¼ï¼šè¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œé”™è¯¯æç¤º
- âœ… è°ƒè¯•æ”¯æŒï¼šä¸°å¯Œçš„æ§åˆ¶å°è¾“å‡ºå’Œæ—¥å¿—ä¿¡æ¯

### ç³»ç»Ÿç¨³å®šæ€§æå‡
- âœ… å¼‚å¸¸å¤„ç†ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·å’Œæ¢å¤æœºåˆ¶
- âœ… èµ„æºç®¡ç†ï¼šæ­£ç¡®çš„è¿æ¥æ± å’Œäº‹åŠ¡ç®¡ç†
- âœ… é”™è¯¯æ¢å¤ï¼šå¤±è´¥æ“ä½œä¸å½±å“ç³»ç»Ÿç¨³å®šæ€§

**ğŸ¯ é€šè¿‡è¿™8ä¸ªBugçš„ä¿®å¤ï¼ŒDocker Registryå®ç°ä»ä¸€ä¸ªæœ‰é—®é¢˜çš„åŸå‹å˜æˆäº†ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„é«˜è´¨é‡ç³»ç»Ÿï¼**

---

## ğŸ“‹ æœ€ç»ˆè´¨é‡è¯„ä¼°

```
åŠŸèƒ½å®Œæ•´æ€§: 100% âœ…
APIè§„èŒƒç¬¦åˆæ€§: 100% âœ…  
æ•°æ®å®Œæ•´æ€§: 100% âœ…
é”™è¯¯å¤„ç†: 100% âœ…
ç”¨æˆ·ä½“éªŒ: ä¼˜ç§€ âœ…
ä»£ç è´¨é‡: é«˜ âœ…
æ–‡æ¡£å®Œæ•´æ€§: å®Œå–„ âœ…

æ€»ä½“è¯„åˆ†: â­â­â­â­â­ (5/5)
```

**è¿™æ¬¡Bugä¿®å¤å†ç¨‹å±•ç¤ºäº†ä»é—®é¢˜å‘ç°åˆ°å½»åº•è§£å†³çš„å®Œæ•´æŠ€æœ¯èƒ½åŠ›ï¼Œæœ€ç»ˆäº¤ä»˜äº†ä¸€ä¸ªé«˜è´¨é‡çš„Docker Registryå®ç°ï¼** ğŸ†
